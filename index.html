<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>日本全国ランダム市区町村抽選マップ</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  #map { height: 60vh; margin-top: 10px; }
  #region-selection label { margin-right: 10px; }
  body { font-family: sans-serif; padding: 10px; }
  button { margin-top: 10px; padding: 5px 10px; font-size: 16px; }
</style>
</head>
<body>

<h2>ランダム市区町村抽選マップ</h2>

<div id="region-selection">
  <label><input type="checkbox" value="北海道" checked> 北海道</label>
  <label><input type="checkbox" value="東北" checked> 東北</label>
  <label><input type="checkbox" value="関東" checked> 関東</label>
  <label><input type="checkbox" value="中部" checked> 中部</label>
  <label><input type="checkbox" value="近畿" checked> 近畿</label>
  <label><input type="checkbox" value="中国" checked> 中国</label>
  <label><input type="checkbox" value="四国" checked> 四国</label>
  <label><input type="checkbox" value="九州" checked> 九州</label>
</div>

<div style="margin-top:5px;">
  <button id="select-all">全選択</button>
  <button id="deselect-all">全解除</button>
</div>

<button id="draw-btn">抽選する</button>

<div id="result" style="margin-top:10px; font-size: 18px;"></div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// 8地方マッピング
const regionMap = {
  "北海道": ["北海道"],
  "東北": ["青森県","岩手県","宮城県","秋田県","山形県","福島県"],
  "関東": ["茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県"],
  "中部": ["新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県"],
  "近畿": ["三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県"],
  "中国": ["鳥取県","島根県","岡山県","広島県","山口県"],
  "四国": ["徳島県","香川県","愛媛県","高知県"],
  "九州": ["福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"]
};

let cities = [];
let map = L.map('map').setView([37.5, 137.5], 5);

// OpenStreetMap タイル
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

// JSONデータ読み込み
fetch('https://code4fukui.github.io/localgovjp/localgovjp.json')
  .then(res => res.json())
  .then(data => { cities = data; })
  .catch(err => console.error(err));

// 抽選関数
function draw() {
  if (!cities.length) return;

  const selectedRegions = Array.from(document.querySelectorAll('#region-selection input:checked'))
                               .map(el => el.value);

  const filteredCities = cities.filter(c => 
    selectedRegions.some(region => regionMap[region].includes(c.pref))
  );

  if (!filteredCities.length) {
    document.getElementById('result').textContent = "選択した地方には該当する市区町村がありません";
    return;
  }

  const choice = filteredCities[Math.floor(Math.random() * filteredCities.length)];
  const displayHTML = `${choice.pref} <ruby>${choice.city}<rt>${choice.citykana}</rt></ruby>`;
  document.getElementById('result').innerHTML = `選ばれた旅先：<br><strong>${displayHTML}</strong>`;

  map.setView([choice.lat, choice.lng], 8);
  L.marker([choice.lat, choice.lng]).addTo(map);
}

// 全選択 / 全解除
document.getElementById('select-all').addEventListener('click', () => {
  document.querySelectorAll('#region-selection input').forEach(cb => cb.checked = true);
});
document.getElementById('deselect-all').addEventListener('click', () => {
  document.querySelectorAll('#region-selection input').forEach(cb => cb.checked = false);
});

// 抽選ボタン
document.getElementById('draw-btn').addEventListener('click', draw);
</script>

</body>
</html>
